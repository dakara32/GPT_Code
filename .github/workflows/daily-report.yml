name: Daily Stock Report

# â– ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«(TRIGGER)
# UTC æ™‚é–“ã§è¨­å®šã€‚JST æœ 08:30 â†’ UTC 23:30 (å‰æ—¥)
on:
  schedule:
    - cron: '30 23 * * *'
  workflow_dispatch:

jobs:
  build-and-report:
    runs-on: ubuntu-latest

    steps:
      # ãƒ‡ãƒãƒƒã‚°ç”¨ã«æœ€åˆã«å¿…ãšãƒ­ã‚°å‡ºåŠ›
      - name: Debug start
        run: echo 'ğŸš€ DEBUG: workflow started'
        
      # 1) ã‚³ãƒ¼ãƒ‰å–å¾—
      - uses: actions/checkout@v3

      # 2) Python ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # 3) å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - run: pip install -r requirements.txt

      # 4) yfinance å–å¾—ï¼†åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
      - run: python analyze_and_email.py

      # 5) ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼ˆSMTP ä¾‹ï¼‰
      - uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.example.com
          server_port: 587
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASS }}
          to:   your@address.com
          subject: "ã€è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆã€‘æ ªä¾¡åˆ†æçµæœ $(date +'%Y-%m-%d')"
          body: |
            è‡ªå‹•åˆ†æçµæœã‚’æ·»ä»˜ã—ã¾ã—ãŸã€‚
            è©³ç´°ã¯ãƒªãƒã‚¸ãƒˆãƒªå†…ãƒ­ã‚°ã‚’ã”å‚ç…§ãã ã•ã„ã€‚
          # attachments: ./report.csv ãªã©ã‚‚æŒ‡å®šå¯èƒ½
