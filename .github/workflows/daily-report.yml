name: Daily Stock Report

on:
  schedule:
    - cron: '30 23 * * *'    # JST 08:30 ã«ç›¸å½“ï¼ˆUTC 23:30ï¼‰
  workflow_dispatch:        # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ã‚’æœ‰åŠ¹åŒ–

jobs:
  build-and-report:
    runs-on: ubuntu-latest

    steps:
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 1. ãƒ‡ãƒãƒƒã‚°ç”¨ã«æœ€åˆã«å¿…ãšãƒ­ã‚°ã‚’å‡ºåŠ›
      - name: Debug start
        run: echo 'ğŸš€ DEBUG: workflow started'

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 2. ã‚³ãƒ¼ãƒ‰å–å¾—
      - name: Checkout repository
        uses: actions/checkout@v3

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 3. Python ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 4. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        run: pip install -r requirements.txt

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 5. åˆ†æï¼†ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
      - name: Run analysis script
        run: python analyze_and_email.py

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # 6. ãƒ¡ãƒ¼ãƒ«é€ä¿¡
      - name: Send email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.example.com
          server_port: 587
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASS }}
          to: your@address.com
          subject: "ã€è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆã€‘æ ªä¾¡åˆ†æçµæœ $(date +'%Y-%m-%d')"
          body: |
            è‡ªå‹•åˆ†æçµæœã‚’æ·»ä»˜ã—ã¾ã—ãŸã€‚
            è©³ç´°ã¯ãƒªãƒã‚¸ãƒˆãƒªå†…ãƒ­ã‚°ã‚’ã”å‚ç…§ãã ã•ã„ã€‚
          # attachments: ./report.csv  # å¿…è¦ã«å¿œã˜ã¦æœ‰åŠ¹åŒ–

