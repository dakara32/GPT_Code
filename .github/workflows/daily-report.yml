name: Daily Stock Report

# ■スケジュール(TRIGGER)
# UTC 時間で設定。JST 朝 08:30 → UTC 23:30 (前日)
on:
  schedule:
    - cron: '30 23 * * *'

jobs:
  build-and-report:
    runs-on: ubuntu-latest

    steps:
      # 1) コード取得
      - uses: actions/checkout@v3

      # 2) Python セットアップ
      - uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # 3) 必要パッケージ インストール
      - run: pip install -r requirements.txt

      # 4) yfinance 取得＆分析スクリプト実行
      - run: python analyze_and_email.py

      # 5) メール送信（SMTP 例）
      - uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.example.com
          server_port: 587
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASS }}
          to:   your@address.com
          subject: "【自動レポート】株価分析結果 $(date +'%Y-%m-%d')"
          body: |
            自動分析結果を添付しました。
            詳細はリポジトリ内ログをご参照ください。
          # attachments: ./report.csv なども指定可能
